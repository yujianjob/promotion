-------------------建立项目表-------------20150723----

create table Partition_Detail( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,Status int not null  default(0) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Organ_Detail( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,ParentId int   ,OType int   ,Remark varchar(50)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Organ_Type( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,ParentId int   ,Permission int not null  default(0) ,Remark varchar(50)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_Account( Id int identity(1,1) primary key   ,UserName varchar(50) not null  ,Password varchar(100) not null  ,Email varchar(200) not null  ,Status int not null  default(1) ,RegisterIP varchar(20)   ,OrganId int   ,Pic varchar(200)   ,Nickname varchar(20)   ,IsRealName bit not null  default(0) ,originUserId varchar(50)   ,origin int   ,OriginUserName varchar(50)   ,IsNeedReName bit not null  default(0) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_BaseInfo( Id int identity(1,1) primary key   ,AccountId int not null  ,TeacherNo varchar(20)   ,GroupId int   ,RealName varchar(120) not null  ,Mobile varchar(30) not null  ,Phone varchar(30) not null  ,Address varchar(300) not null  ,PostCode varchar(10) not null  ,CredentialsType int not null  ,CredentialsNumber varchar(30) not null  ,Sex int not null  ,Birthday datetime not null  ,Nation int not null  ,PoliticalStatus int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_InfoFK( Id int identity(1,1) primary key   ,InfoType int not null  ,Title varchar(50)   ,Remark varchar(500)   ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_TrainingRedit( Id int identity(1,1) primary key   ,TrainingField int not null  ,PlanId int not null  ,AccountId int not null  ,Credits float not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_ClassRegister( Id int identity(1,1) primary key   ,ClassId int not null  ,PlanId int not null  ,AccountId int not null  ,Status int not null  ,ApplyRemark varchar(500)   ,BatchCode uniqueidentifier   ,ManagerId int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_ClassRegisterApplication( Id int identity(1,1) primary key   ,ClassRegisterId int not null  ,Status int not null  ,Remark varchar(500)   ,Creater int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_ClassComment( Id int identity(1,1) primary key   ,ClassId int not null  ,AccountId int not null  ,Content varchar(2000)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  Member_ClassOverall( Id int identity(1,1) primary key   ,ClassId int not null  ,AccountId int not null  ,CurrentSchedule int not null  default(0) ,TotalSchedule int not null  default(0) ,ReadingScore float   ,DiscussScore float   ,HomeWorkScore float   ,TestingScore float   ,ExaminationScore float   ,CommentScore float   ,TotalScore float   ,Result int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  Member_PlanOverall( PlanId int not null  ,AccountId int not null  ,Result int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_InOut( Id int identity(1,1) primary key   ,AccountId int not null  ,SourceOrganId int   ,TargetOrganId int   ,Creater int   ,Status int not null  ,ApplyRemark varchar(500)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  Member_InOutApplication( Id int identity(1,1) primary key   ,InOutId int not null  ,Status int not null  ,Remark varchar(500)   ,Creater int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_PracticalCourse( Id int identity(1,1) primary key   ,AccountId int not null  ,PracticalCourseId int   ,OrganId int   ,Creater int   ,Status int not null  ,ApplyRemark varchar(500)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_PracticalCourseApplication( Id int identity(1,1) primary key   ,FlowId int not null  ,Status int not null  ,Remark varchar(500)   ,Creater int   ,AccountId int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Member_PlanExemption( Id int identity(1,1) primary key   ,PlanId int not null  ,Status int not null  ,Remark varchar(100)   ,Credits float   ,PEType int   ,Creater int   ,AccountId int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Training_Plan( Id int identity(1,1) primary key   ,PartitionId int not null  ,Title varchar(50) not null  ,IsOpen bit not null  default(0) ,Sort int not null  default(50) ,Display bit not null  default(0) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Training_Credits( Id int identity(1,1) primary key   ,PlanId int not null  ,TraningField int not null  ,Level int not null  ,MinValue float not null  ,MaxValue float not null  ,Sort int not null  default(50) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_Detail( Id int identity(1,1) primary key   ,PartitionId int not null  ,Title varchar(200) not null  ,Content varchar(3000) not null  ,Pic varchar(200)   ,AccountId int not null  ,OrganId int   ,Status int not null  default(0) ,IsGen bit not null  default(0) ,GenTime datetime   ,Display bit not null  default(1) ,Sort int not null  default(50) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitDetail( Id int identity(1,1) primary key   ,TrainingId int   ,Title varchar(200) not null  ,Content varchar(8000) not null  ,ParentId int   ,Display bit not null  default(1) ,Sort int not null  default(50) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitContent( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,Content varchar(8000) not null  ,UnitType int not null  ,TestCnt int   ,PrintScore bit   ,TimeLimit int   ,PassLine int   ,FinalTestLimit bit   ,UnitId int   ,TimeLength int   ,OpenTime int   ,EndTime int   ,Display bit not null  default(1) ,Sort int not null  default(50) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitReplyDetail( Id int identity(1,1) primary key   ,UnitId int not null  ,ClassId int not null  ,Content varchar(2000)   ,AccountId int not null  ,ParentReplyId int   ,AttList varchar(2000)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitReplyGroup( Id int identity(1,1) primary key   ,UnitId int not null  ,ClassId int not null  ,Title varchar(200)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitReplyGroupMember( GroupId int not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitHomeWork( Id int identity(1,1) primary key   ,UnitId int not null  ,ClassId int not null  ,Content varchar(2000)   ,AccountId int not null  ,ParentReplyId int   ,AttList varchar(2000)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitQuestion( Id int identity(1,1) primary key   ,Verson varchar(20) not null  ,UnitId int not null  ,Content varchar(2000)   ,QTtype int not null  ,Question varchar(8000)   ,Answer varchar(100)   ,Credit float not null  ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitAnswer( Id int identity(1,1) primary key   ,AnswerResult int not null  ,Question int not null  ,Answer varchar(100)   ,Result bit not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitAnswerResult( Id int identity(1,1) primary key   ,Verson varchar(20) not null  ,UnitId int not null  ,ClassId int not null  ,Score int not null  ,QuestionCnt int   ,RightAnswer int   ,WrongAnswer int   ,Result bit not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitTest( Id int identity(1,1) primary key   ,UnitId int not null  ,Verson varchar(20) not null  ,Content varchar(2000)   ,QTtype int not null  ,Question varchar(8000)   ,Answer varchar(100)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitTestAnswer( Id int identity(1,1) primary key   ,AnswerResult int not null  ,Question int not null  ,Answer varchar(100)   ,Credit float not null  ,Result bit not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Course_UnitTestAnswerResult( Id int identity(1,1) primary key   ,Verson varchar(200) not null  ,UnitId int not null  ,ClassId int not null  ,Score int not null  ,QuestionCnt int   ,RightAnswer int   ,WrongAnswer int   ,Result bit not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_Detail( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,Content varchar(8000) not null  ,Pic varchar(200)   ,Creater int not null  ,OrganId int   ,TraingField int not null  ,TraingCategory int not null  default(0) ,TraingTopic int   ,TraningObject int not null  default(0) ,Subject int not null  default(0) ,StudyLevel int not null  default(0) ,TotalTime float   ,TrainingForm int   ,TeacherTitle int   ,TeacherName varchar(20)   ,TeacherFrom varchar(50)   ,TeacherPic varchar(500)   ,Outline varchar(8000)   ,PartitionId int not null  ,OutSideType int not null  default(0) ,OutSideLink varchar(500)   ,Range int not null  ,Status int not null  default(1) ,ApplyRemark varchar(500)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_Teacher( Id int identity(1,1) primary key   ,TraningId int not null  ,PlatformManagerId int   ,Status int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_Attachment( Id int identity(1,1) primary key   ,TraningId int not null  ,Title varchar(200)   ,Link varchar(500)   ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_ApplyApplication( Id int identity(1,1) primary key   ,TraningId int not null  ,Status int not null  ,Remark varchar(500)   ,Creater int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_Detail( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,TraningId int not null  ,PlanId int not null  ,SignUpStartTime datetime not null  ,SignUpEndTime datetime not null  ,OpenClassFrom datetime not null  ,OpenClassTo datetime not null  ,ClassForm int   ,People int not null  default(0) ,LimitPeopleCnt int not null  default(0) ,Address varchar(200)   ,Content varchar(500)   ,ManagerId int not null  ,OrganId int   ,Subject varchar(200)   ,StudyLevel varchar(200)   ,TeachGrade varchar(200)   ,TeachRank varchar(200)   ,OrganRange varchar(500)   ,Instructor int   ,Status int not null  default(1) ,ApplyRemark varchar(500)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  Class_AddressList( Id int identity(1,1) primary key   ,ClassId int not null  ,AccountId int not null  ,Tel varchar(30)   ,Email varchar(300)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  Class_Notice( Id int identity(1,1) primary key   ,ClassId int not null  ,Title varchar(200) not null  ,Content varchar(8000)   ,Creater int   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_ApplyApplication( Id int identity(1,1) primary key   ,ClassId int not null  ,Status int not null  ,Remark varchar(500)   ,Creater int   ,AccountId int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_HomeWorkMission( Id int identity(1,1) primary key   ,Title varchar(50) not null  ,ClassId int not null  ,Content varchar(2000)   ,StartDate datetime   ,EndDate datetime   ,AttList varchar(2000)   ,Creater int   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_HomeWork( Id int identity(1,1) primary key   ,HomeWorkId int not null  ,ClassId int not null  ,Content varchar(2000)   ,AccountId int not null  ,ParentReplyId int   ,AttList varchar(2000)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_TraningCommentQuestion( Id int identity(1,1) primary key   ,Verson varchar(20) not null  ,Content varchar(2000)   ,QTtype int not null  ,Question varchar(8000)   ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_TraningCommentAnswer( Id int identity(1,1) primary key   ,AnswerResult int not null  ,Question int not null  ,Credit int   ,Chose varchar(20) not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Class_TraningCommentResult( Id int identity(1,1) primary key   ,Verson varchar(200) not null  ,ClassId int not null  ,Score int not null  ,AccountId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table PracticalCourse_Detail( Id int identity(1,1) primary key   ,Title varchar(200) not null  ,Category int not null  ,Content varchar(8000)   ,IsBatch bit not null  default(0) ,OrganId int   ,AccountId int   ,PlanId int not null  ,People int not null  default(0) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table PracticalCourse_Attachment( Id int identity(1,1) primary key   ,PracticalCourseId int not null  ,Title varchar(200)   ,Link varchar(500)   ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table PracticalCourse_Role( Id int identity(1,1) primary key   ,Title varchar(200)   ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table PracticalCourse_RoleCredits( Id int identity(1,1) primary key   ,Title varchar(200)   ,TraingField int not null  ,TraingCategory int not null  default(0) ,TraingTopic int   ,RoleId int   ,Credits float not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_InfoFk( Id int identity(1,1) primary key   ,CategoryType int not null  ,Title varchar(50)   ,Remark varchar(500)   ,ParentId int   ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_Field( Id int identity(1,1) primary key   ,Title varchar(50)   ,Remark varchar(500)   ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_Category( Id int identity(1,1) primary key   ,Title varchar(50)   ,Remark varchar(500)   ,Field int not null  ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Traning_Topic( Id int identity(1,1) primary key   ,Title varchar(50)   ,Remark varchar(500)   ,CategoryId int not null  ,Sort int not null  default(50) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Sys_Message( Id int identity(1,1) primary key   ,Title varchar(50)   ,Content varchar(500)   ,AccountId int   ,Creater int not null  ,Status int not null  default(0) ,Display bit not null  default(1) ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table Sys_Parameters( id int identity(1,1) primary key   ,Range varchar(10)   ,ParameterKey varchar(20)   ,ParameterValue varchar(1000)   ,Remark varchar(30)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table PlatformManager_Detail( Id int identity(1,1) primary key   ,AccountId int not null  ,PartitionId int not null  ,Status int not null  default(1) ,OrganId int not null  ,Level int not null  default(0) ,GroupId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  PlatformManager_Groups( Id int identity(1,1) primary key   ,Title nvarchar(10) not null  ,Remark varchar(50)   ,Role varchar(500)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table  PlatformManager_Role( Id int identity(1,1) primary key   ,Title nvarchar(20) not null  ,Content varchar(300)   ,PagePath varchar(500)   ,sort int not null  default(50) ,MenuText varchar(20)   ,MenuPath varchar(300)   ,ParentId int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table SystemManager_Detail( Id int identity(1,1) primary key   ,UserName varchar(20) not null  ,Password varchar(50) not null  ,Email varchar(100)   ,RealName nvarchar(10)   ,Mobile varchar(30)   ,Address varchar(30)   ,Status int not null  default(1) ,OrganId int not null  ,Level int not null  default(0) ,GroupId int not null  ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table SystemManager_Groups( Id int identity(1,1) primary key   ,Title nvarchar(10) not null  ,Remark varchar(50)   ,Role varchar(500)   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );
create table SystemManager_Role( Id int identity(1,1) primary key   ,Title nvarchar(20) not null  ,Content varchar(300)   ,PagePath varchar(500)   ,sort int not null  default(50) ,MenuText varchar(20)   ,MenuPath varchar(300)   ,ParentId int   ,Delflag bit not null  default(0) ,CreateDate datetime not null  default(Getdate())  );

--------------------------------20150806--------------------------------
USE [2015AbilityPromotion]
GO

/****** Object:  StoredProcedure [dbo].[sp_recursion]    Script Date: 08/06/2015 15:02:25 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[sp_recursion]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[sp_recursion]
GO

USE [2015AbilityPromotion]
GO

/****** Object:  StoredProcedure [dbo].[sp_recursion]    Script Date: 08/06/2015 15:02:25 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[sp_recursion] 
	@TableName VARCHAR(500),
	@IdName VARCHAR(500),
	@ParentIdName VARCHAR(500),
	@KeyId int
AS
BEGIN
  declare @SqlText nvarchar(4000)
  set @SqlText='with cte as ('
  +'select A.'+@IdName+',A.'+@ParentIdName+' from '+@TableName+' A where '+@IdName+'='+cast(@KeyId as nvarchar(10))
  +' union all'
  +' select B.'+@IdName+',B.'+@ParentIdName+' from '+@TableName+' B join cte C on C.'+@IdName+'=B.'+@ParentIdName+')'
  +' select '+@IdName+' from cte'
  EXEC(@SqlText)
END

GO
